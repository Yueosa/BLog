---
title: 二进制逆向学习笔记 (2)
subTitle: CPU寄存器
date: 2025-10-06
updated: 2025-10-06
cover: /cover/binary/cover_thetwo.jpg
toc: true
categories:
  - 学习
  - 二进制逆向
tags:
  - 二进制
  - 逆向工程
---

# 寄存器是什么

**CPU 寄存器是集成在处理器内部的高速存储单元，用于暂时保存指令、数据或地址。**

> CPU 可以直接读取并操作寄存器中的数据，由于其访问速度远高于内存（RAM），合理使用寄存器是程序高效运行的关键。

---

## x86 与 x86-64 下寄存器的不同

`x86 (32位)`架构下，寄存器命名以`E`开头，宽度为 **32 位**，只有 8 个通用寄存器

`x86-64 (64位)`架构下，寄存器命名以`R`开头，宽度为 **64 字节**，新增了 8 个通用寄存器，兼容 32 位寄存器的同时提高了性能

---

## 寄存器的分类

#### | 通用寄存器

> 主要用于算术运算、逻辑运算、数据传输等通用任务

以下列举了 **8** 个通用寄存器，以及 `x86-64` 特有的 **8** 个通用寄存器

| 名称(x86) | 名称(x86-64) | 用途               | 描述                                                                      |
| --------- | ------------ | ------------------ | ------------------------------------------------------------------------- |
| `EAX`     | `RAX`        | **累加器**         | 作为算术和逻辑运算的默认寄存器，也常用于存放函数返回值                    |
| `EBX`     | `RBX`        | **基址寄存器**     | 通常用于存放数据段的基地址                                                |
| `ECX`     | `RCX`        | **计数器**         | 常用于循环计数                                                            |
| `EDX`     | `RDX`        | **数据寄存器**     | 通常配合 `EAX` 进行乘除法等操作                                           |
| `ESI`     | `RSI`        | **源索引寄存器**   | 指向源数据的地址                                                          |
| `EDI`     | `RDI`        | **目的索引寄存器** | 指向目标数据的地址                                                        |
|           | `R8` - `R15` | **x86-64 特有**    | 它们同样可以访问低 32 位（如 R8D）、低 16 位（如 R8W）和低 8 位（如 R8B） |

同时还有俩个特殊的通用寄存器，他们与栈操作相关
| 名称(x86) | 名称(x86-64) | 用途 | 描述 |
| --------- | ------------ | ------------------ | ------------------------------------------------------ |
| `ESP` | `RSP` | **栈指针寄存器** | 始终指向当前线程栈的顶部 |
| `EBP` | `RBP` | **基址指针寄存器** | 指向栈帧的地步，用于定位栈帧中的参数和局部变量 |

> `x64`优化代码中，通常使用 `RSP` 直接寻址

#### | 指令指针寄存器

**EIP / RIP**

保存着**下一条将要执行的指令的内存地址**

控制了 `EIP / RIP` 就等于控制了程序即将执行的操作，许多漏洞的核心都是修改 `EIP / RIP` 的值

#### | 段寄存器 (大部分已废)

在早期的 `x86` 架构中，内存采用“分段”模型进行管理，段寄存器用于指定不同内存段的基地址。在现代操作系统的平坦内存模型下，大部分段的功能已被废弃

这里简单介绍 `Windows` 系统下的两个段寄存器

- **FS**
  在 32 位模式下，指向**当前线程的`TEB`**

- **GS**
  在 64 位模式下，指向**当前线程的`TEB`**

##### `TEB` 与 `PEB`
